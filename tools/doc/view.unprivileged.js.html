<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: providers/view.unprivileged.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: providers/view.unprivileged.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>/**
 * A FreeDOM view is provided as a core service to providers, allowing them
 * the capability of providing screen realestate.  Implementation is conducted
 * as a sandboxed iFrame at separate origin, whose sendMessage channel is
 * given to the provider.
 */
var View_unprivileged = function(channel) {
  this.host = null;
  this.win = null;
  this.channel = channel;
  handleEvents(this);
};

View_unprivileged.prototype.open = function(args, continuation) {
  this.host = document.createElement("div");
  document.body.appendChild(this.host);
  var root = this.host;
  // TODO(willscott): Support shadow root as available.
  if (this.host['webkitCreateShadowRoot']) {
    root = this.host['webkitCreateShadowRoot']();
  }
  var frame = document.createElement("iframe");
  frame.setAttribute("sandbox", "allow-scripts allow-forms");
  if (args['file']) {
    frame.src = args['file'];
  } else if (args['code']) {
    frame.src = "data:text/html;charset=utf-8," + args['code'];
  }
  frame.style.width = "0";
  frame.style.height = "0";
  root.appendChild(frame);
  this.win = frame;
  addEventListener('message', this.onMessage.bind(this), true);
  continuation({});
}

View_unprivileged.prototype.show = function(continuation) {
  if (this.win) {
    // Fullscreen mode.
    this.win.style.position = 'fixed';
    this.win.style.top = '0px';
    this.win.style.left = '0px';
    this.win.style.width = '100%';
    this.win.style.height = '100%';
    this.win.style.background = 'rgba(255,255,255,0.75)';
    this.win.style.border = '0px';
    
    // Refresh Layout
    this.host.style.position = 'absolute';
  }
  continuation();
}

View_unprivileged.prototype.postMessage = function(args, continuation) {
  this.win.contentWindow.postMessage(args, '*');
}

View_unprivileged.prototype.close = function() {
  if (this.host) {
    this.host.parentNode.removeChild(this.host);
    this.host = null;
  }
  if (this.win) {
    removeEventListener('message', this.onMessage.bind(this), true);
    this.win = null;
  }
}

View_unprivileged.prototype.onMessage = function(m) {
  if (m.source == this.win.contentWindow) {
    this.channel.postMessage({
      'action':'event',
      'type': 'message',
      'value': m.data
    });
  }
}

fdom.apis.register("core.view", View_unprivileged);
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="api.html">api</a></li><li><a href="fdom.app.External.html">External</a></li><li><a href="fdom.app.Internal.html">Internal</a></li><li><a href="fdom.Proxy.html">Proxy</a></li><li><a href="fdom.Proxy.messageChannel.html">messageChannel</a></li></ul><h3>Global</h3><ul><li><a href="global.html#conform">conform</a></li><li><a href="global.html#eachProp">eachProp</a></li><li><a href="global.html#eachReverse">eachReverse</a></li><li><a href="global.html#handleEvents">handleEvents</a></li><li><a href="global.html#isAppContext">isAppContext</a></li><li><a href="global.html#makeAbsolute">makeAbsolute</a></li><li><a href="global.html#mixin">mixin</a></li><li><a href="global.html#scripts">scripts</a></li><li><a href="global.html#setup">setup</a></li><li><a href="global.html#Storage_unprivileged">Storage_unprivileged</a></li><li><a href="global.html#this['emit']">this['emit']</a></li><li><a href="global.html#Transport_unprivileged">Transport_unprivileged</a></li><li><a href="global.html#update">update</a></li><li><a href="global.html#View_unprivileged">View_unprivileged</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0-dev</a> on Thu Mar 14 2013 11:47:15 GMT-0700 (PDT)
</footer>

<script> prettyPrint(); </script>
</body>
</html>
