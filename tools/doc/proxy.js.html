<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: src/proxy.js</title>
    
    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">
    
    <h1 class="page-title">Source: src/proxy.js</h1>
    
    


    
    <section>
        <article>
            <pre class="prettyprint source"><code>// TODO: This should make use of ECMA6 Proxies once they are standardized.
// see: https://code.google.com/p/v8/issues/detail?id=1543
var fdom = fdom || {};

/**
 * A fdomProxy or subclass are the exposed interface for freedom applications
 * and providers.  The interface is determined by the constructor arguments.
 * Three types of proxies are currently used:
 * A generic messageChannel, which allows for events ('emit', 'on'), and properties ('set', 'get').
 * A templatedProxy, which appears as a pre-defined definition.
 * A templatedDelegator, which delegates calls to a provider implementing a pre-defined definition.
 * @param {fdom.Channel} channel the Channel backing this interface.
 * @param {Object?} definition An API definition if one is specified.
 * @param {boolean} provider Whether this interface provides or consumes a service.
 * @constructor
 */
fdom.Proxy = function(channel, definition, provider) {
  if (definition) {
    if (provider) {
      return new fdom.Proxy.templatedDelegator(channel, definition);
    } else {
      return new fdom.Proxy.templatedProxy(channel, definition);
    }
  } else {
    return new fdom.Proxy.messageChannel(channel);
  }
};


/**
 * A freedom endpoint for an unconstrained, unpriveledged channel.
 * @param {fdom.Channel} channel The Channel backing this interface.
 * @constructor
 */
fdom.Proxy.messageChannel = function(channel) {
  handleEvents(this);
  var emitter = this['emit'];
  var values = {};

  /**
   * Update emission of events to cross the underlying channel.
   */
  this['emit'] = function(type, data) {
    channel.postMessage({
      'action': 'event',
      'type': type,
      'data': data
    });
    emitter(type, data);
  };

  /**
   * Get a property from this object.
   * @param {String} key the property to get.
   */
  this.get = function(key) {
    if (values.hasOwnProperty(key)) {
      return values[key];
    } else {
      return undefined;
    }
  };

  /**
   * Set a property on this object, and replicate across the channel.
   * @param {String} key the property to set.
   * @param {JSON} value the value for the property.
   */
  this.set = function(key, value) {
    if (values.hasOwnProperty(key) || values[key] === undefined) {
      values[key] = value;
      channel.postMessage({
        'action': 'set',
        'key': key,
        'value': value
      });
    }
  }
  
  /**
   * Handle messages from across the channel.
   */
  channel['on']('message', function(msg) {
    if (msg['action'] == 'event') {
      emitter(msg['type'], msg['data']);
    } else if (msg['action'] == 'set') {
      values[msg['key']] = msg['value'];
    }
  });  
};
</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Index</a></h2><h3>Classes</h3><ul><li><a href="api.html">api</a></li><li><a href="fdom.app.External.html">External</a></li><li><a href="fdom.app.Internal.html">Internal</a></li><li><a href="fdom.Proxy.html">Proxy</a></li><li><a href="fdom.Proxy.messageChannel.html">messageChannel</a></li></ul><h3>Global</h3><ul><li><a href="global.html#conform">conform</a></li><li><a href="global.html#eachProp">eachProp</a></li><li><a href="global.html#eachReverse">eachReverse</a></li><li><a href="global.html#handleEvents">handleEvents</a></li><li><a href="global.html#isAppContext">isAppContext</a></li><li><a href="global.html#makeAbsolute">makeAbsolute</a></li><li><a href="global.html#mixin">mixin</a></li><li><a href="global.html#scripts">scripts</a></li><li><a href="global.html#setup">setup</a></li><li><a href="global.html#Storage_unprivileged">Storage_unprivileged</a></li><li><a href="global.html#this['emit']">this['emit']</a></li><li><a href="global.html#Transport_unprivileged">Transport_unprivileged</a></li><li><a href="global.html#update">update</a></li><li><a href="global.html#View_unprivileged">View_unprivileged</a></li></ul>
</nav>

<br clear="both">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.0-dev</a> on Thu Mar 14 2013 12:02:49 GMT-0700 (PDT)
</footer>

<script> prettyPrint(); </script>
</body>
</html>
